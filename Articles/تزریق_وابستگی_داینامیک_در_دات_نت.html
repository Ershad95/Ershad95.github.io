<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="description" content="اگه یادتون باشه در رابطه با تزریق داینامیک وابستگی ها یه سری مطلب گذاشته بودم و روی آپارات هم به صورت کامل توضیح دادم حالا داستان تزریق وابستگی داینامیک بدون نوشتن کد های تکراری روی سورس Nop Commerce پیاده سازی کردم و واقعا خوب جواب داده! با من باشید جادوگری ها داریم :)   ">
   <meta name="keywords" content="Nop Commerce،ErshadRaoufi،ارشاد رئوفی،تزریق وابستگی،برنامه نویسی داینامیک،تزریق وابستگی داینامیک در Nop Commerce">
   <meta name="author" content="ارشاد رئوفی">
   <meta name="generator" content="ارشاد رئوفی" />
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="css/bootstrap.css">
   <link rel="stylesheet" href="css/bootstrap-icons.css">
   <link rel="stylesheet" href="css/owl.carousel.css">
   <link rel="stylesheet" href="css/owl.theme.default.css">
   <link rel="stylesheet" href="style.css">
   <title>تزریق وابستگی داینامیک در Nop Commerce</title>
</head>

<body>
   <header>
      <div class="index-top position-relative w-100 bg-white">
         <div>
            <div class="container">

               <div class="row">
                  <div class="col-md-9 col-5 pt-2">
                     <nav class="navbar navbar-expand-lg navbar-light">
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                           data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                           aria-expanded="false" aria-label="Toggle navigation">
                           <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                           <ul class="navbar-nav mb-2 mb-lg-0">
                              <li class="nav-item">
                                 <a class="nav-link active" aria-current="page" href="/Articles">خانه</a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="/Articles">مقالات</a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="/#contact" tabindex="-1" aria-disabled="true">تماس با ما</a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="/#contact" tabindex="-1" aria-disabled="true">درباره</a>
                              </li>

                           </ul>
                        </div>
                     </nav>
                  </div>

               </div>
            </div>
         </div>
      </div>
   </header>
   <div class="container">
      <div class="row">
         <div class="col-12">
            <div class="breadcrumb-wrap p-3 bg-white  rounded">
               <nav>
                  <ol class="d-flex">
                     <li><a href="/Articles">خانه</a></li>
                     <li>تزریق وابستگی داینامیک در Nop Commerce
                     </li>
                  </ol>
               </nav>
            </div>
         </div>
      </div>
   </div>
   <section class="mb-12">
      <div class="container">
         <div class="row">
            <div class="col-lg-12">
               <article>
                  <div class="section-top-single bg-white rounded p-3">
                     <div class="row">
                        <div class="col-md-6">
                           <figure>
                              <img src="img/blog/di.jpg" alt="تزریق وابستگی داینامیک در Nop Commerce"
                                 class="img-thumbnail d-table mx-auto">
                           </figure>
                        </div>
                        <div class="col-md-6">
                           <div class="border rounded p-3 mb-3">
                              <h1 class="border-bottom">تزریق وابستگی داینامیک در Nop Commerce
                              </h1>
                              <ul class="detail-single d-flex">
                                 <li><i class="bi bi-clock p-1"></i>&nbsp;08 مرداد</li>
                              </ul>
                              <p class="short-desc">اگه یادتون باشه در رابطه با تزریق داینامیک وابستگی ها یه سری مطلب گذاشته بودم و روی  <a href="https://www.aparat.com/v/nIua0?playlist=1622695">آپارات</a> هم به صورت کامل توضیح دادم حالا داستان تزریق وابستگی داینامیک بدون نوشتن کد های تکراری روی سورس <a href="https://www.nopcommerce.com/">Nop Commerce</a> پیاده سازی کردم و واقعا خوب جواب داده! با من باشید جادوگری ها داریم :)
                                  </p>
                              <p>به قلم <a href="/">ارشاد رئوفی</a></p>
                              <p> سورس نهایی ایده <a href="https://github.com/Ershad95/Dynamic_Dependency_Injection_Nop_Commerce4.50">Github Repository </a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="content-single rounded bg-white p-3 mt-3">
                     <h5> سلام <a href="https://ershad95.github.io/">ارشاد رئوفی</a> هستم - اگه یادتون باشه در رابطه با تزریق داینامیک وابستگی ها یه سری مطلب گذاشته بودم و روی <a href="https://www.aparat.com/v/nIua0?playlist=1622695">آپارات</a> هم به صورت کامل توضیح دادم حالا  داستان تزریق وابستگی داینامیک بدون نوشتن کد های تکراری روی سورس  <a href="https://www.nopcommerce.com/">Nop Commerce</a> پیاده سازی کردم و واقعا خوب جواب داده! با من باشید جادوگری ها داریم :)</h5>
                       <h4>مراحل پیاده سازی : </h4>
                       <hr />
                     <p>اول از همه یک اینترفیس به اسم ICustomService ایجاد کردم که صرفا یک Prop به اسم InjectType داره و مشخصی میکنه به چه صورتی این سرویس به ServiceCollection تزریق بشه اما مهم تر از اینکه تزریق مشخص کنه -مشخص میکنه چه سرویس هایی توسط ما اضافه شدن و با سرویس های خود nop تفکیک میشه حالا چه جوری ؟؟؟</p>
                     <h4>قانون اول :‌ </h4>
                     <hr />
                        <p>برای هر سرویسی که می نویسیم و میخوایم DI رو روش اعماال کنیم باید Interface ICustomService رو به ارث برده باشه دقیقا به خاطر دو دلیللی که بالا بهش اشاره شد.</p>
                      
                        <h4>قانون دوم :‌ </h4>
                        <hr />
                        <p>هر کلاسی که میاد و Interface مرتبط به سرویس ها رو پیاده سازی میکنه باید prop InjectType رو در سازنده خودش مقداردهی کنه تا متوجه بشیم از چه طریقی باید تزریق انجام بشه تا اینجا یه چارچوب مشخص کردیم تا سرویس ها رو بتونیم تشخیص بدیم اما هنوز کار اصلی مونده !!!</p>
                        <h4>تعیین نقطه شروع :  </h4>
                        <hr />
                        <p>باید نقطه شروع به کار Nop پیدا کنیم اینم مدونیم که نقطه شروع Dot Net Core قست StartUp هست ولی میخواییم با معماری Nop جلو بریم پس با یکم بررسی و دیدن کد ها به یه کلاسی میرسیم به اسم NopStartup در قسمت Nop.Web.Framework - مسیر دقیقش ‌:‌ Nop.Web.Framework\Infrastructure\NopStartup.cs حالا این کلاس چیه ؟؟؟ در واقع هر کلاسی که از سرویس INopStartup ارث بری کرده باشه اولویت پیدا میکنه و قبل از کدهای دیگه اجرا میشه به همین سادگی! باید یه کلاس جدید به اسم مثلا CustomDependencyInjection ایجاد کنیم با این تفاوت که حتما از کلاس NopStartup ارث بری کرده باشه و نکته خیلی مهم این باید متدی به اسم ConfigureServices رو override کنه حالا داخل متدی که گقتم بایدشروع کنیم به جادو گری!!!</p>
                       
                       
                       
                        <h4>تحلیل کدهای متد ConfigureServices :   </h4>
                        <hr />
                      
                       <pre>
                        //-------------Get All Services-------------
                        var asm = AppDomain.CurrentDomain
                                    .GetAssemblies()
                                    .Single(x => x.FullName.Contains("Nop.Services"));
                       </pre>
                        <p>در این کد اسمبلی قسمت Nop.Service برمیداریم چرا؟؟ چون تمام سرویس هایی که می نویسیم در این قسمت قرار داره اگر خدایی نکرده خواستید سرویس هاتون رو جای دیگه ای بنویسد باید اسم Nop.Service به چیزی که میخوایید تغییر بدید من تطبق استاندارد جلو رفتم پس شما هم قانون مند باشید !</p>
                        
                        
                        <p>یادتونه گقتم باید مشخص بشه چه سرویس هایی رو ما مشخص کردیم ! اینجا وقتشه ازش استفاده کنیم و سرویس های خودمون رو تفکیک کنیم

                        </p>
                      <pre>
                        //-----------Get All Custom Service Classess-------
var allRelatedClassServices = types.Where(x => x.IsClass);
//-----------Get All Custom Service Interfaces-------
var allRelatedInterfaceServices = types.Where(x => x.IsInterface);
                      </pre>
                     <p>تو این مرحله تمام کلاس ایمنترفیس هایی که شخصی سازی کردیم رو به دست میاریم

                     </p>

                     <p>اینم از مرحله آخر یعنی ارتباط دادن سرویس ها کلاس و اینترفیس های کلاس

                     </p>
                     <pre>
                        //-----------Matche Class Services To Related Interface Services-------
foreach (var classService in allRelatedClassServices)
{
//-----------get related interface for service class-----------
var interfaceService = allRelatedInterfaceServices.Single(x => x.Name == $"I{classService.Name}");
}
                     </pre>
                     <h4>قانون سوم :
                     </h4>
                     <hr />
                     <p>کلاس ها و اینترفیس های سرویس باید یک نام گذاری واحد داشته باشند برای این قانون از استاندارد خود Nop که خیلی منطقی هم هست استفاده کردم یعنی :

                     </p>
                     <h5>Class Name : Entitiy_Name + "Service"
                     </h5>
                     <h5>Interface Name : "I"+Entitiy_Name + "Service"
                     </h5>
                     <p>با استفاده از همین الگو میتونم خیلی راحت سرویس و اینترفیس مرتبط به هم وصل کنم حالا به چه روشی تزریق کنیم ؟؟؟ یادتونه که یک prop داشتیم به اسم Inject وقتشه ازش استفاده کنیم

                     </p>
                     <pre>
                        var InjectValue = (InjectType)classService.GetProperty("Inject")
.GetValue(Activator.CreateInstance(classService), null);
//----------finally Add Custom Service To Service Collection-----------
switch (InjectValue)
{
case InjectType.Scopped:
services.AddScoped(interfaceService, classService);
break;
case InjectType.Transit:
services.AddTransient(interfaceService, classService);
break;
case InjectType.SingleTon:
services.AddSingleton(interfaceService, classService);
break;
default:
break;
}
                     </pre>
                     <p>یادتون باشه این کلاس صرفا یکبار در حیات نرم افزار اجرا میشه و قرار نیست در طی جرخف نرم افزار این متذ با کدهایی که گقتم اجرا بشن پس نگران هزینه بربودن یا اشغال شدن منابع سیستمی نباشید :)</p>
                  </div>
                  <div class="rounded bg-white p-3 mt-3">
                     <p> سورس نهایی ایده<a href="https://github.com/Ershad95/Dynamic_Dependency_Injection_Nop_Commerce4.50"> Github Repository </a></p>
                     <p>ویدیوهای برنامه نویسی<a href="https://github.com/Ershad95/Dynamic_Dependency_Injection_Nop_Commerce4.50"> کانال آپارات </a></p>
                  </div>
               </article>
            </div>

         </div>
      </div>
   </section>

   <footer class="bg-white py-4 text-center">
      <div class="container">
         <div class="row">
            <div class="card">
               <div class="card-header">
                  <h4>راه های ارتباطی</h4>
               </div>
               <div class="card-body">
                  <div class="row">
                     <div class="col-md-2">
                        <i class="fa fa-map fa-2x"></i>
                        <h5 class="card-title">آدرس</h5>
                        <p class="card-text">ایران تهران</p>
                     </div>
                     <div class="col-md-2">
                        <i class="fa fa-2x fa-linkedin"></i>
                        <h5 class="card-title">لینکدین : </h5>
                        <p class="card-text">
                           <a title="لینک لینکدین ارشاد رئوفی" target="_blank"
                              href="https://ir.linkedin.com/in/ershad74">Ershad74R</a>
                        </p>
                     </div>
                     <div class="col-md-2">
                        <i class="fa fa-instagram fa-2x"></i>
                        <h5 class="card-title">اینستاگرام : </h5>
                        <p class="card-text">
                           <a title="لینک اینستاگرام ارشاد رئوفی" target="_blank"
                              href="https://instagram/Ershad74R">Ershad74R</a>
                        </p>
                     </div>
                     <div class="col-md-2">
                        <i class="fa fa-github fa-2x"></i>
                        <h5 class="card-title">گیت هاب : </h5>
                        <p class="card-text">
                           <a title="لینک گیت هاب ارشاد رئوفی" target="_blank"
                              href="https://github.com/Ershad95">Ershad95</a>
                        </p>
                     </div>
                     <div class="col-md-2">
                        <i class="fa  fa-send fa-2x"></i>
                        <h5 class="card-title">ایمیل : </h5>
                        <p class="card-text">
                           <a target="_blank" href="mailto:ErshadRaoufi@gmail.com">ErshadRaoufi@gmail.com</a>
                        </p>
                     </div>

                     <div class="col-md-2">
                        <i class="fa fa-film fa-2x"></i>
                        <h5 class="card-title">کانال آپارات : </h5>
                        <p class="card-text">
                           <a target="_blank" title='لینک کانال آپارات ارشاد رئوفی'
                              href="https://www.aparat.com/Ershad74">Ershad74</a>
                        </p>
                     </div>
                  </div>

               </div>
               <div class="card-footer ">
                  بروز شده همین چند لحظه قبل
               </div>
            </div>

         </div>


      </div>
   </footer>
   <div class="scroll_top">
      <span class="btn btn-info text-center text-light">
         <i class="bi bi-arrow-up"></i>
      </span>
   </div>
   <script src="js/jQuery.js"></script>
   <script src="js/popper.js"></script>
   <script src="js/bootstrap.js"></script>
   <script src="js/owl.carousel.js"></script>
   <script src="js/index.js"></script>
   <script src="https://seo90.ir/downloads/category/html-theme/"></script>
</body>

</html>